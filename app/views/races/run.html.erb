<h1><%@race.name%></h1>

<% tfunc = ["linear", "linear", "ease-in", "ease-in", "ease-out", "ease-in-out"] %>
<% delay = 1%>

<% lane_one = @race.snail_races.first%>
<% lane_two = @race.snail_races.second%>
<% lane_three = @race.snail_races.third%>
<% lane_four = @race.snail_races.fourth%>

<% timers = [lane_one.snail.speed(@race),lane_two.snail.speed(@race),lane_three.snail.speed(@race),lane_four.snail.speed(@race)]%>
<% ranks = timers.sort%>
<% lane_one.update(rank: ranks.index(timers[0])+1)%>
<% lane_two.update(rank: ranks.index(timers[1])+1)%>
<% lane_three.update(rank: ranks.index(timers[2])+1)%>
<% lane_four.update(rank: ranks.index(timers[3])+1)%>
<% winner = SnailRace.find_by(race_id: @race.id, rank: 1)%>
<% payout = winner.bets.inject(0){|sum,x| sum + x.amount }*4%>
<% payee = User.find(session[:user_id])%>
<% payee.update(money: payee.money+=payout)%>
<div class='results'>
    <h1>
    <%= "You Won" if payout > 0%>
    <h1>
</div>

<div class="racer-one">
    <div style="animation: racer-one <%=timers[0]%>s <%=delay%>s <%=tfunc.sample%> forwards;">
        <div class="snail">
            <%= image_tag(lane_one.snail.shell.image, class: "shell")%>
            <div class ="chug">
                <%= image_tag(lane_one.snail.body.image, style: "animation: chug #{timers[0]/15}s #{delay}s steps(4) #{timers[0].ceil};")%>
            </div>
        </div>
    </div>
</div>
<div class="racer-two">
    <div style="animation: racer-two <%=timers[1]%>s <%=delay%>s <%=tfunc.sample%> forwards;">
        <div class="snail">
            <%= image_tag(lane_two.snail.shell.image, class: "shell")%>
            <div class ="chug">
                <%= image_tag(lane_two.snail.body.image, style: "animation: chug #{timers[1]/15}s #{delay}s steps(4) #{timers[1].ceil};")%>
            </div>
        </div>
    </div>
</div>
<div class="racer-three">
    <div style="animation: racer-three <%=timers[2]%>s <%=delay%>s <%=tfunc.sample%> forwards;">
        <div class="snail">
            <%= image_tag(lane_three.snail.shell.image, class: "shell")%>
            <div class ="chug">
                <%= image_tag(lane_three.snail.body.image, style: "animation: chug #{timers[2]/15}s #{delay}s steps(4) #{timers[2].ceil};")%>
            </div>
        </div>
    </div>
</div>
<div class="racer-four">
    <div style="animation: racer-four <%=timers[3]%>s <%=delay%>s <%=tfunc.sample%> forwards;">
        <div class="snail">
            <%= image_tag(lane_four.snail.shell.image, class: "shell")%>
            <div class ="chug">
                <%= image_tag(lane_four.snail.body.image, style: "animation: chug #{timers[3]/15}s #{delay}s steps(4) #{timers[3].ceil};")%>
            </div>
        </div>
    </div>
</div>

<div class="prize">
    <%= image_tag(@race.prize.image)%>
</div>